
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>File Organization &#8212; VAMPIRES DPP</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=4fea3ae4a0a4ba949df0a89bbae557cc2ce861ae" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Polarimetric Differential Imaging (PDI)" href="polarimetric_differential_imaging.html" />
    <link rel="prev" title="Examples" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">VAMPIRES DPP</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../gettingstarted.html">
   Getting started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../pipeline.html">
   Pipeline
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Examples
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     File Organization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="polarimetric_differential_imaging.html">
     Polarimetric Differential Imaging (PDI)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="image_registration.html">
     Image Registration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="frame_selection.html">
     Frame Selection
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api/index.html">
   API/Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/organization.html">
     Organization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/pipeline.html">
     Pipeline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/calibration.html">
     Calibration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/frame_selection.html">
     Frame Selection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/image_registration.html">
     Image Registration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/image_processing.html">
     Image Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/satellite_spots.html">
     Satellite Spots
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right"><a href="https://github.com/scexao-org/vampires_dpp"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/examples/file_organization.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-and-imports">
   Setup and Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#observation-tables">
   Observation Tables
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sorting-files">
   Sorting Files
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calibration-files">
     Calibration files
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparing-for-processing">
   Preparing for processing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#file-lists">
     1. File lists
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sub-directories">
     2. Sub-directories
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#direct-configuration">
     3. Direct configuration
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>File Organization</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-and-imports">
   Setup and Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#observation-tables">
   Observation Tables
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sorting-files">
   Sorting Files
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calibration-files">
     Calibration files
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparing-for-processing">
   Preparing for processing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#file-lists">
     1. File lists
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sub-directories">
     2. Sub-directories
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#direct-configuration">
     3. Direct configuration
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="file-organization">
<h1>File Organization<a class="headerlink" href="#file-organization" title="Permalink to this headline">#</a></h1>
<p>This notebook shows two ways of using <code class="docutils literal notranslate"><span class="pre">vampires_dpp</span></code> to help organize your data for processing. This notebook can be downloaded as <strong><a class="reference download internal" download="" href="../_downloads/e1b46699fa5b1f156d75fcf05768570e/file_organization.ipynb"><code class="xref download myst-nb docutils literal notranslate"><span class="pre">file_organization.ipynb</span></code></a></strong>.</p>
<section id="setup-and-imports">
<h2>Setup and Imports<a class="headerlink" href="#setup-and-imports" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from pathlib import Path
import pandas as pd
import vampires_dpp as vpp
from zenodo_get import zenodo_get

datadir = Path(&quot;data&quot;)
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># download example data
zenodo_get([&quot;10.5281/zenodo.7359198&quot;, &quot;-o&quot;, datadir.absolute()])
</pre></div>
</div>
</div>
</div>
</section>
<section id="observation-tables">
<h2>Observation Tables<a class="headerlink" href="#observation-tables" title="Permalink to this headline">#</a></h2>
<p>To help organize our data, which is often in a single directory with STARS frame IDs that provide no useful identification, we can sort, filter, and save all of the data from the FITS headers. We have an automated utility which scrapes all the FITS headers and stores the data into a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>.</p>
<p>Here is an example of how to load your input data into a table and save that to a CSV</p>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from vampires_dpp.headers import observation_table

datadir = Path(&quot;data&quot;)
filelist = datadir.glob(&quot;VMPA*.fits&quot;)
table = observation_table(filelist) # sorts by DATE by default
table.to_csv(datadir / &quot;hd32297_20220225_headers.csv&quot;)
</pre></div>
</div>
</div>
</div>
<p>For this example, we will load a table from observations on 2022/02/25 of HD 32297 in polarimetric imaging mode.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>table = pd.read_csv(datadir / &quot;hd32297_20220225_headers.csv&quot;)
table.keys()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Unnamed: 0&#39;, &#39;path&#39;, &#39;SIMPLE&#39;, &#39;BITPIX&#39;, &#39;NAXIS&#39;, &#39;NAXIS1&#39;, &#39;NAXIS2&#39;,
       &#39;NAXIS3&#39;, &#39;EXTEND&#39;, &#39;BSCALE&#39;,
       ...
       &#39;D_LOOP&#39;, &#39;D_LTTG&#39;, &#39;D_PSUBG&#39;, &#39;D_STTG&#39;, &#39;D_TTCMTX&#39;, &#39;D_TTGAIN&#39;,
       &#39;D_WTTG&#39;, &#39;DATE&#39;, &#39;U_FLCSTT&#39;, &#39;COMMENT&#39;],
      dtype=&#39;object&#39;, length=116)
</pre></div>
</div>
</div>
</div>
</section>
<section id="sorting-files">
<h2>Sorting Files<a class="headerlink" href="#sorting-files" title="Permalink to this headline">#</a></h2>
<p>We need to separate out the calibration data from the science data, including the reference stars. From this observation, our targets were as follows</p>
<p><strong>Science Targets</strong></p>
<ul class="simple">
<li><p>HD 32297</p></li>
</ul>
<p><strong>Reference Targets</strong></p>
<ul class="simple">
<li><p>HD 42352 (Polarized Standard)</p></li>
<li><p>HD 87423 (Unpolarized Standard)</p></li>
<li><p>HD 32909 (PSF Reference)</p></li>
</ul>
<p>We will use pandas’ <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.query.html"><code class="docutils literal notranslate"><span class="pre">query</span></code></a> functionality to easily sort our files by target</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sci_table = table.query(&quot;OBJECT == &#39;HD32297&#39;&quot;)
pol_table = table.query(&quot;OBJECT == &#39;HD42352&#39;&quot;)
unpol_table = table.query(&quot;OBJECT == &#39;HD87423&#39;&quot;)
psfref_table = table.query(&quot;OBJECT == &#39;HD32909&#39;&quot;)

print(f&quot;Science files: {len(sci_table)}&quot;)
print(f&quot;Pol. standard files: {len(pol_table)}&quot;)
print(f&quot;Unpol. standard files: {len(unpol_table)}&quot;)
print(f&quot;PSF ref. files: {len(psfref_table)}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Science files: 650
Pol. standard files: 30
Unpol. standard files: 46
PSF ref. files: 36
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pol_table.FRAMEID
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     VMPA00022047
1     VMPA00022048
2     VMPA00022049
3     VMPA00022050
4     VMPA00022051
5     VMPA00022052
6     VMPA00022053
7     VMPA00022054
8     VMPA00022055
9     VMPA00022056
10    VMPA00022057
11    VMPA00022058
12    VMPA00022059
13    VMPA00022060
14    VMPA00022063
15    VMPA00022064
16    VMPA00022065
17    VMPA00022066
18    VMPA00022067
19    VMPA00022068
20    VMPA00022069
21    VMPA00022070
22    VMPA00022071
23    VMPA00022072
24    VMPA00022073
25    VMPA00022074
26    VMPA00022075
27    VMPA00022076
28    VMPA00022077
29    VMPA00022078
Name: FRAMEID, dtype: object
</pre></div>
</div>
</div>
</div>
<section id="calibration-files">
<h3>Calibration files<a class="headerlink" href="#calibration-files" title="Permalink to this headline">#</a></h3>
<p>Depending on when you observed with VAMPIRES and who your suppert astronomers were, your calibration files (typically just dark frames) can be found a few ways.</p>
<p>For example, if your darks were archived in STARS and were taken with the mirror in, you can use the <code class="docutils literal notranslate"><span class="pre">U_MASK</span></code> value to filter the table</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dark_table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;U_MASK == &#39;Mirror&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the darks were just taken during slews, you can try filtering <code class="docutils literal notranslate"><span class="pre">U_OGFNAM</span></code> (the filename as saved to the VAMPIRES computer, usually much more descriptive) for “skies”</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dark_table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;U_OGFNAM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;skies&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>In some cases, you may be given the dark files directly if they were not saved in STARS. In that case, you should just store them in your data directory and add the filenames directly to your pipeline configuration.</p>
<p>For our observations, we took dark frames during slews, so we’ll use the “skies” method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dark_table = table.loc[table[&quot;U_OGFNAM&quot;].str.contains(&quot;skies&quot;)]

print(f&quot;Dark frames (skies): {len(dark_table)}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dark frames (skies): 26
</pre></div>
</div>
</div>
</div>
<p>now we don’t need all of these cubes to make our calibration files- in general you shouldn’t need more than a few hundred or thousand frames in total (typically one data cube). It is important, however, to match the exposure time and EM gain of our other images!</p>
<p>The <code class="docutils literal notranslate"><span class="pre">find_dark_settings</span></code> function will automatically sort through the files and find the unique combinations of exposure times and EM gains.</p>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from vampires_dpp.util import find_dark_settings

print(&quot;\n&quot;.join(f&quot;Science: {t} s / EM {e:.0f}&quot; for t, e in find_dark_settings(sci_table.path)))
print(&quot;\n&quot;.join(f&quot;Pol. standard: {t} s / EM {e:.0f}&quot; for t, e in find_dark_settings(pol_table.path)))
print(&quot;\n&quot;.join(f&quot;Unpol. standard: {t} s / EM {e:.0f}&quot; for t, e in find_dark_settings(unpol_table.path)))
print(&quot;\n&quot;.join(f&quot;PSF ref.: {t} s / EM {e:.0f}&quot; for t, e in find_dark_settings(psfref_table.path)))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Science: 0.5 s / EM 300
Science: 0.25 s / EM 300
Pol. standard: 0.25 s / EM 10
Pol. standard: 0.25 s / EM 300
Unpol. standard: 0.5 s / EM 0
Unpol. standard: 0.5 s / EM 280
PSF ref.: 0.5 s / EM 300
</pre></div>
</div>
</div>
</div>
<p>we can see from the EM gain switches that some of the standard stars were taken with the coronagraph in (high gain) and with the coronagraph out (low gain). We could use this information to further filter the tables with <code class="docutils literal notranslate"><span class="pre">query</span></code>, but for now we’re only going to focus on the main science observations, which are those with exposure time of 0.5 seconds and 300 EM gain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sci_table = sci_table.query(&quot;EXPTIME == 0.5&quot;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dark_table[&quot;EXPTIME&quot;].unique(), dark_table[&quot;U_EMGAIN&quot;].unique()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([0.5]), array([300.]))
</pre></div>
</div>
</div>
</div>
<p>our sky frames only cover the 0.5 second, 300 EM gain files. In order to fully calibrate our reference data, we would need to reach out to the SCExAO team to record some darks for the other exposure times and gains.</p>
<p>From the skies, we only need one cube per camera, so we’ll select the first two</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cam1_dark = dark_table.query(&quot;U_CAMERA == 1&quot;).iloc[0]
cam2_dark = dark_table.query(&quot;U_CAMERA == 2&quot;).iloc[0]
print(f&quot;Cam 1 dark: {cam1_dark.path}&quot;)
print(f&quot;Cam 2 dark: {cam2_dark.path}&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cam 1 dark: /Volumes/mlucas SSD1/2022/20220225/VMPA00022727.fits
Cam 2 dark: /Volumes/mlucas SSD1/2022/20220225/VMPA00022723.fits
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="preparing-for-processing">
<h2>Preparing for processing<a class="headerlink" href="#preparing-for-processing" title="Permalink to this headline">#</a></h2>
<p>Now that we have our file lists, we can prepare them for processing using the <code class="docutils literal notranslate"><span class="pre">vampires_dpp</span></code> pipeline. We’ll show you a few ways for organizing your data so you can chose one that suits your needs and tweak to your liking!</p>
<section id="file-lists">
<h3>1. File lists<a class="headerlink" href="#file-lists" title="Permalink to this headline">#</a></h3>
<p>We can take our dataframes and save the paths of our selected files to simple text files, which can be input directly into the pipeline</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sci_files = datadir / &quot;hd32297_files.txt&quot;
with open(sci_files, &quot;w&quot;) as fh:
    fh.writelines(&quot;\n&quot;.join(sci_table[&quot;path&quot;]))

dark_files = datadir / &quot;dark_files.txt&quot;
with open(dark_files, &quot;w&quot;) as fh:
    fh.writelines(&quot;\n&quot;.join(c.path for c in (cam1_dark, cam2_dark)))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>!head data/hd32297_files.txt
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Volumes/mlucas SSD1/2022/20220225/VMPA00022083.fits
/Volumes/mlucas SSD1/2022/20220225/VMPA00022084.fits
/Volumes/mlucas SSD1/2022/20220225/VMPA00022085.fits
/Volumes/mlucas SSD1/2022/20220225/VMPA00022086.fits
/Volumes/mlucas SSD1/2022/20220225/VMPA00022087.fits
/Volumes/mlucas SSD1/2022/20220225/VMPA00022088.fits
/Volumes/mlucas SSD1/2022/20220225/VMPA00022089.fits
/Volumes/mlucas SSD1/2022/20220225/VMPA00022090.fits
/Volumes/mlucas SSD1/2022/20220225/VMPA00022091.fits
/Volumes/mlucas SSD1/2022/20220225/VMPA00022092.fits
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>!head data/dark_files.txt
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Volumes/mlucas SSD1/2022/20220225/VMPA00022727.fits
/Volumes/mlucas SSD1/2022/20220225/VMPA00022723.fits
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from vampires_dpp.pipeline import Pipeline

pipeline = Pipeline.from_str(f&quot;&quot;&quot;
version = &quot;{vpp.__version__}&quot;
name=&quot;HD32297_20220225&quot;
directory=&quot;{datadir.absolute()}&quot;
output_directory=&quot;{datadir.absolute() / &quot;processed&quot;}&quot;
filenames=&quot;{sci_files.absolute()}&quot;

[coronagraph]
mask_size=58 # mas

[coronagraph.satellite_spots]
radius = 31.8 # lam/D

[calibration]
output_directory=&quot;calibrated&quot;

[calibration.darks]
filenames=&quot;{dark_files.absolute()}&quot;

[registration]
output_directory=&quot;registered&quot;

[collapsing]
output_directory=&quot;collapsed&quot;

[derotate]
output_directory=&quot;derotated&quot;
&quot;&quot;&quot;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="sub-directories">
<h3>2. Sub-directories<a class="headerlink" href="#sub-directories" title="Permalink to this headline">#</a></h3>
<p>If you prefer to copy your data into sub-directories, you can do that straight from our tables and using Python’s built-in file management tools. Here we will use symlinks to save storage space, but you could use <code class="docutils literal notranslate"><span class="pre">shutil.copyfile</span></code> if you wanted to make hard copies instead.</p>
<div class="cell tag_skip-execution docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sci_dir = datadir / &quot;hd32297_science&quot;
sci_dir.mkdir(parents=True, exist_ok=True)
for filename in sci_table[&quot;path&quot;]:
    path = Path(filename)
    outpath = sci_dir / path.name
    outpath.symlink_to(path)


dark_dir = datadir / &quot;darks&quot;
dark_dir.mkdir(parents=True, exist_ok=True)
for filename in (cam1_dark.path, cam2_dark.path):
    path = Path(filename)
    outpath = dark_dir / path.name
    outpath.symlink_to(path)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pipeline = Pipeline.from_str(f&quot;&quot;&quot;
version = &quot;{vpp.__version__}&quot;
name=&quot;HD32297_20220225&quot;
directory=&quot;{datadir.absolute()}&quot;
output_directory=&quot;{datadir.absolute() / &quot;processed&quot;}&quot;
filenames=&quot;hd32297_science/VMPA*.fits&quot;

[coronagraph]
mask_size=58 # mas

[coronagraph.satellite_spots]
radius = 31.8 # lam/D

[calibration]
output_directory=&quot;calibrated&quot;

[calibration.darks]
filenames=&quot;darks/VMPA*.fits&quot;

[registration]
output_directory=&quot;registered&quot;

[collapsing]
output_directory=&quot;collapsed&quot;

[derotate]
output_directory=&quot;derotated&quot;
&quot;&quot;&quot;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="direct-configuration">
<h3>3. Direct configuration<a class="headerlink" href="#direct-configuration" title="Permalink to this headline">#</a></h3>
<p>The last way we could do this is by directly creating a configuration dictionary, bypassing the TOML configuration altogether.</p>
<div class="caution admonition">
<p class="admonition-title">Advanced Usage</p>
<p>We don’t recommend using this method unless you’re very familiar with the API. The heavily-nested structure can be easy to screw up, leading to silent failures like missing dark subtraction.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pipeline = Pipeline({
    &quot;version&quot;: vpp.__version__,
    &quot;name&quot;: &quot;HD32297_20220225&quot;,
    &quot;directory&quot;: datadir,
    &quot;output_directory&quot;: datadir / &quot;processed&quot;,
    &quot;filenames&quot;: sci_table[&quot;path&quot;],
    &quot;coronagraph&quot;: {&quot;mask_size&quot;: 58, &quot;satellite_spots&quot;: {&quot;radius&quot;: 31.8}},
    &quot;calibration&quot;: {
        &quot;output_directory&quot;: &quot;calibrated&quot;,
        &quot;darks&quot;: {&quot;filenames&quot;: (cam1_dark.path, cam2_dark.path)}
    },
    &quot;registration&quot;: {&quot;output_directory&quot;: &quot;registered&quot;},
    &quot;collapsing&quot;: {&quot;output_directory&quot;: &quot;collapsed&quot;},
    &quot;derotate&quot;: {&quot;output_directory&quot;: &quot;derotated&quot;},
})
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Examples</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="polarimetric_differential_imaging.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Polarimetric Differential Imaging (PDI)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Miles Lucas<br/>
  
      &copy; Copyright 2022, Miles Lucas.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>